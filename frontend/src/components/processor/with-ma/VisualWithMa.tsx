import { ExecutionContext, StepContext } from "@src/components/code/CodeProvider";
import ALU from "@src/components/processor/parts/ALU";
import Bus from "@src/components/processor/parts/Bus";
import Multiplexer from "@src/components/processor/parts/Multiplexer";
import ObscureMemory from "@src/components/processor/parts/ObscureMemory";
import RegisterBox from "@src/components/processor/parts/RegisterBox";
import { LineStateMa } from "@src/interface/Line";
import { useContext } from "react";

/**
 * Affiche le chemin de donnée du processeur à accumulateur avec MA
 * @returns le composant react
 */
export default function VisualWithMa() {
    const steps = useContext(ExecutionContext);
    const { count } = useContext(StepContext);

    const lineState = steps[count].stimulatedLineState;

    const fetch = lineState == LineStateMa.fetch;
    const decode = lineState == LineStateMa.decode;
    const addSubMul = lineState == LineStateMa.addSubMul;
    const addSubA = lineState == LineStateMa.addSubA;
    const addSubX = lineState == LineStateMa.addSubX;
    const sh = lineState == LineStateMa.sh;
    const store = lineState == LineStateMa.store;
    const load = lineState == LineStateMa.load;
    const loadA = lineState == LineStateMa.loadA;
    const loadI = lineState == LineStateMa.loadI;
    const storeA = lineState == LineStateMa.storeA;
    const storeI = lineState == LineStateMa.storeI;
    const branching = lineState == LineStateMa.branching;
    const nop = lineState == LineStateMa.nop || addSubMul || addSubA || addSubX || sh || store || load || loadA || loadI || storeA || storeI;

    const addr = addSubMul || addSubA || store || load || loadA || storeA;

    return (
        <svg width="100%" height="100%" viewBox="0 0 1175 401" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                id="mux-pc"
                d="M80 109C79.4477 109 79 109.448 79 110C79 110.552 79.4477 111 80 111L80 109ZM141 110L131
                   104.226L131 115.774L141 110ZM80 110L80 111L132 111L132 110L132 109L80 109L80 110Z"
            />
            <use href="#mux-pc" fill="white"/>
            <path
                id="pc-mux"
                d="M291 109C291.552 109 292 109.448 292 110V175H352V170.227L362 176L352 181.773V177H291C290.965
                   177 290.931 176.999 290.897 176.995C290.595 176.964 290.333 176.799 290.171 176.56C290.117
                   176.48 290.074 176.392 290.045 176.298C290.025 176.235 290.012 176.17 290.005 176.103C290.001
                   176.069 290 176.035 290 176V111H261C260.448 111 260 110.552 260 110C260 109.448 260.448 109 261 109H291Z"
            />
            <use href="#pc-mux" fill="white"/>
            <path
                id="inc"
                d="M291 39C291.552 39 292 39.4477 292 40V110C292 110.552 291.552 111 291 111H261C260.448 111 260 110.552 260
                   110C260 109.448 260.448 109 261 109H290V41H3V86H33V81.2266L43 87L33 92.7734V88H2C1.95118 88 1.90339 87.995
                   1.85645 87.9883C1.80908 87.9815 1.76275 87.9722 1.71777 87.959C1.69325 87.9518 1.66921 87.9436 1.6455
                   87.9346C1.6403 87.9326 1.63505 87.9308 1.62988 87.9287C1.61291 87.9219 1.59658 87.9139 1.58008 87.9062C1.56233
                   87.898 1.54451 87.8901 1.52734 87.8809C1.52233 87.8782 1.51766 87.8749 1.5127 87.8721C1.49276 87.8609 1.47317
                   87.8494 1.4541 87.8369C1.44388 87.8302 1.43378 87.8234 1.42383 87.8164C1.40518 87.8032 1.38681 87.7898 1.36914
                   87.7754C1.36539 87.7723 1.3621 87.7687 1.3584 87.7656C1.33929 87.7496 1.32059 87.7332 1.30273 87.7158C1.29613
                   87.7094 1.28962 87.7029 1.2832 87.6963C1.26696 87.6796 1.25138 87.6623 1.23633 87.6445C1.23186 87.6392 1.22701
                   87.6343 1.22266 87.6289C1.20933 87.6125 1.19685 87.5954 1.18457 87.5781C1.17751 87.5682 1.17076 87.5581 1.16406
                   87.5479C1.13691 87.5065 1.11268 87.4632 1.0918 87.418C1.08608 87.4056 1.07944 87.3935 1.07422 87.3809C1.03828 87.2937
                   1.01481 87.2001 1.00488 87.1025L1 87V40C1 39.4477 1.44772 39 2 39H291Z"
            />
            <use href="#inc" fill="white"/>
            <path
                id="mux3-mem"
                d="M399 202C398.448 202 398 202.448 398 203C398 203.552 398.448 204 399 204V202ZM492 203L482 197.226V208.774L492 203ZM399
                   203V204H483V203V202H399V203Z"
            />
            <use href="#mux3-mem" fill="white"/>
            <path
                id="mem-alu"
                d="M586 155C585.448 155 585 155.448 585 156C585 156.552 585.448 157 586 157V155ZM758.012 156L748.012 150.226V161.774L758.012
                   156ZM586 156V157H749.012V156V155H586V156Z"
            />
            <use href="#mem-alu" fill="white"/>
            <path
                id="mem-ir"
                d="M616 155C616.552 155 617 155.448 617 156V328C617 328.552 616.552 329 616 329H112C111.482 329 111.056 328.607 111.005 328.103L111
                   328V259L111.005 258.897C111.015 258.8 111.038 258.706 111.074 258.618C111.079 258.606 111.086 258.593 111.092 258.581C111.113
                   258.536 111.137 258.492 111.164 258.451C111.171 258.441 111.178 258.431 111.185 258.421C111.197 258.404 111.209 258.387 111.223
                   258.37C111.227 258.365 111.232 258.36 111.236 258.354C111.273 258.311 111.314 258.27 111.358 258.233C111.362 258.23 111.365
                   258.227 111.369 258.224C111.387 258.209 111.405 258.196 111.424 258.183C111.434 258.176 111.444 258.169 111.454 258.162C111.473
                   258.15 111.493 258.138 111.513 258.127C111.518 258.124 111.522 258.121 111.527 258.118C111.545 258.109 111.562 258.101 111.58
                   258.093C111.597 258.085 111.613 258.077 111.63 258.07C111.635 258.068 111.64 258.066 111.646 258.064C111.669 258.055 111.693
                   258.047 111.718 258.04C111.763 258.027 111.809 258.018 111.856 258.011C111.903 258.004 111.951 258 112 258H131V253.227L141
                   259L131 264.773V260H113V327H615V157H586C585.448 157 585 156.552 585 156C585 155.448 585.448 155 586 155H616Z"
            />
            <use href="#mem-ir" fill="white"/>
            <path
                id="mem-acc"
                d="M902 97L892 102.773V98H617V156C617 156.552 616.552 157 616 157H586C585.448 157 585 156.552 585 156C585
                   155.448 585.448 155 586 155H615V97C615 96.4477 615.448 96 616 96H892V91.2266L902 97Z"
            />
            <use href="#mem-acc" fill="white"/>
            <path
                id="mem-ma"
                d="M841 96C841.552 96 842 96.4477 842 97V276H892V271.227L902 277L892 282.773V278H841C840.448 278 840
                   277.552 840 277V98H617V156C617 156.552 616.552 157 616 157H586C585.448 157 585 156.552 585 156C585
                   155.448 585.448 155 586 155H615V97C615 96.4477 615.448 96 616 96H841Z"
            />
            <use href="#mem-ma" fill="white"/>
            <path
                id="alu-acc"
                d="M902 139L892 144.773V140H866V195C866 195.552 865.552 196 865 196H825C824.448 196 824 195.552 824
                   195C824 194.448 824.448 194 825 194H864V139C864 138.448 864.448 138 865 138H892V133.227L902 139Z"
            />
            <use href="#alu-acc" fill="white"/>
            <path
                id="alu-ma"
                d="M865 194C865.552 194 866 194.448 866 195V232H892V227.227L902 233L892 238.773V234H865C864.448 234
                   864 233.552 864 233V196H825C824.448 196 824 195.552 824 195C824 194.448 824.448 194 825 194H865Z"
            />
            <use href="#alu-ma" fill="white"/>
            <path
                id="ir-mem"
                d="M362 203L352 208.773V204H303V258C303 258.552 302.552 259 302 259H261C260.448 259 260 258.552 260
                   258C260 257.448 260.448 257 261 257H301V203C301 202.448 301.448 202 302 202H352V197.227L362 203Z"
            />
            <use href="#ir-mem" fill="white"/>
            <path
                id="ir-pc"
                d="M43 131L33 136.773V132H2V202H302C302.552 202 303 202.448 303 203V258C303 258.048 302.995 258.096
                   302.988 258.143C302.985 258.162 302.983 258.182 302.979 258.201C302.964 258.278 302.938 258.35
                   302.906 258.419C302.886 258.463 302.863 258.505 302.837 258.545C302.83 258.555 302.823 258.565
                   302.816 258.575C302.786 258.618 302.752 258.659 302.716 258.696C302.709 258.703 302.703 258.709
                   302.696 258.716C302.68 258.732 302.662 258.748 302.645 258.763C302.639 258.767 302.634 258.772
                   302.629 258.776C302.612 258.79 302.595 258.802 302.578 258.814C302.568 258.822 302.558 258.828
                   302.548 258.835C302.529 258.847 302.51 258.858 302.491 258.869C302.484 258.873 302.477 258.878
                   302.47 258.882C302.453 258.891 302.435 258.899 302.418 258.907C302.406 258.913 302.394 258.92
                   302.381 258.925C302.358 258.934 302.334 258.942 302.311 258.95C302.306 258.952 302.301 258.954
                   302.296 258.955C302.234 258.974 302.169 258.988 302.103 258.995L302 259H261C260.448 259 260 258.552
                   260 258C260 257.448 260.448 257 261 257H301V204H1C0.482323 204 0.0562144 203.607 0.00488281 203.103L0
                   203V131C0 130.448 0.447715 130 1 130H33V125.227L43 131Z"
            />
            <use href="#ir-pc" fill="white"/>
            <path
                id="mux-acc"
                d="M939 120C938.448 120 938 120.448 938 121C938 121.552 938.448 122 939 122V120ZM1005 121L995
                   115.226V126.774L1005 121ZM939 121V122H996V121V120H939V121Z"
            />
            <use href="#mux-acc" fill="white"/>
            <path
                id="mux-ma"
                d="M939 254C938.448 254 938 254.448 938 255C938 255.552 938.448 256 939 256V254ZM1005 255L995
                   249.226V260.774L1005 255ZM939 255V256H996V255V254H939V255Z"
            />
            <use href="#mux-ma" fill="white"/>
            <path
                id="acc-alu"
                d="M1155 120C1155.55 120 1156 120.448 1156 121V329C1156 329.552 1155.55 330 1155 330H654C653.482
                   330 653.056 329.607 653.005 329.103L653 329V260C653 259.448 653.448 259 654 259H661V254.227L671
                   260L661 265.773V261H655V328H1154V122H1125C1124.45 122 1124 121.552 1124 121C1124 120.448 1124.45
                   120 1125 120H1155Z"
            />
            <use href="#acc-alu" fill="white"/>
            <path
                id="acc-mem"
                d="M1155 15C1155.55 15.0002 1156 15.4478 1156 16C1156 16.0055 1156 16.0111 1156 16.0166V121C1156 121.552
                   1155.55 122 1155 122H1125C1124.45 122 1124 121.552 1124 121C1124 120.448 1124.45 120 1125
                   120H1154V17H315V102H352V97.2266L362 103L352 108.773V104H314C313.448 104 313 103.552 313 103V16C313
                   15.8426 313.037 15.694 313.102 15.5615C313.105 15.5541 313.108 15.5464 313.112 15.5391C313.119 15.5261
                   313.127 15.5136 313.134 15.501C313.143 15.4858 313.152 15.4707 313.161 15.4561C313.171 15.4415 313.18
                   15.4271 313.19 15.4131C313.198 15.4028 313.206 15.3928 313.214 15.3828C313.224 15.3699 313.234 15.3571
                   313.245 15.3447C313.255 15.3331 313.266 15.3217 313.276 15.3105C313.286 15.3004 313.296 15.29 313.306
                   15.2803C313.32 15.2668 313.334 15.2538 313.349 15.2412C313.358 15.2329 313.368 15.2247 313.378 15.2168C313.388
                   15.2085 313.399 15.2012 313.41 15.1934C313.426 15.1818 313.442 15.1698 313.458 15.1592C313.471 15.1508 313.485
                   15.1435 313.498 15.1357C313.509 15.1294 313.52 15.1232 313.531 15.1172C313.546 15.1095 313.56 15.1018 313.575
                   15.0947C313.591 15.0874 313.606 15.0798 313.622 15.0732C313.635 15.0678 313.649 15.0635 313.663 15.0586C313.678
                   15.0534 313.692 15.0475 313.707 15.043C313.765 15.0253 313.824 15.0129 313.886 15.0059C313.89 15.0054 313.894
                   15.0053 313.897 15.0049L314 15H1155Z"
            />
            <use href="#acc-mem" fill="white"/>
            <path id="ma-mem"
                d="M1170 0C1170.55 0 1171 0.447715 1171 1V257C1171 257.048 1170.99 257.096 1170.99 257.143C1170.99 257.162
                   1170.98 257.182 1170.98 257.201C1170.96 257.278 1170.94 257.35 1170.91 257.419C1170.89 257.463 1170.86
                   257.505 1170.84 257.545C1170.83 257.555 1170.82 257.565 1170.82 257.575C1170.79 257.618 1170.75 257.659
                   1170.72 257.696C1170.71 257.703 1170.7 257.709 1170.7 257.716C1170.68 257.732 1170.66 257.748 1170.64
                   257.763C1170.64 257.767 1170.63 257.772 1170.63 257.776C1170.61 257.79 1170.6 257.802 1170.58 257.814C1170.57
                   257.822 1170.56 257.828 1170.55 257.835C1170.53 257.847 1170.51 257.858 1170.49 257.869C1170.48 257.873
                   1170.48 257.878 1170.47 257.882C1170.45 257.891 1170.44 257.899 1170.42 257.907C1170.41 257.913 1170.39
                   257.92 1170.38 257.925C1170.36 257.934 1170.33 257.942 1170.31 257.95C1170.31 257.952 1170.3 257.954 1170.3
                   257.955C1170.23 257.974 1170.17 257.988 1170.1 257.995L1170 258H1125C1124.45 258 1124 257.552 1124 257C1124
                   256.448 1124.45 256 1125 256H1169V2H332V58H352V53.2266L362 59L352 64.7734V60H331C330.448 60 330 59.5523 330
                   59V1C330 0.95123 330.004 0.903348 330.011 0.856445C330.018 0.809126 330.027 0.762714 330.04 0.717773C330.054
                   0.6702 330.072 0.62442 330.093 0.580078C330.113 0.536337 330.136 0.494146 330.162 0.454102C330.169 0.443887
                   330.176 0.433779 330.183 0.423828C330.232 0.354212 330.29 0.29127 330.354 0.236328C330.36 0.231861 330.365
                   0.227015 330.37 0.222656C330.387 0.209328 330.404 0.196854 330.421 0.18457C330.431 0.177508 330.441 0.170766
                   330.451 0.164062C330.47 0.151946 330.489 0.140789 330.508 0.129883C330.515 0.125785 330.522 0.121109 330.529
                   0.117188C330.546 0.108141 330.564 0.0998808 330.581 0.0917969C330.593 0.0860705 330.606 0.0794465 330.618
                   0.0742188C330.641 0.0647401 330.665 0.0566107 330.688 0.0488281C330.693 0.0472297 330.698 0.0454702 330.703
                   0.0439453C330.765 0.0245981 330.831 0.0116928 330.897 0.00488281L331 0H1170Z"
            />
            <use href="#ma-mem" fill="white"/>
            <path
                id="ma-addr"
                d="M362 228L352 233.773V229H331V342H1169V258H1125C1124.45 258 1124 257.552 1124 257C1124 256.448 1124.45 256
                   1125 256H1170L1170.1 256.005C1170.17 256.012 1170.23 256.025 1170.3 256.044C1170.3 256.045 1170.31 256.047
                   1170.31 256.049C1170.33 256.057 1170.36 256.065 1170.38 256.074C1170.39 256.079 1170.41 256.086 1170.42
                   256.092C1170.44 256.1 1170.45 256.108 1170.47 256.117C1170.48 256.121 1170.48 256.126 1170.49 256.13C1170.51
                   256.141 1170.53 256.152 1170.55 256.164C1170.56 256.171 1170.57 256.178 1170.58 256.185C1170.6 256.197 1170.61
                   256.209 1170.63 256.223C1170.63 256.227 1170.64 256.232 1170.64 256.236C1170.66 256.251 1170.68 256.267 1170.7
                   256.283C1170.7 256.29 1170.71 256.296 1170.72 256.303C1170.75 256.34 1170.79 256.381 1170.82 256.424C1170.82
                   256.434 1170.83 256.444 1170.84 256.454C1170.86 256.494 1170.89 256.536 1170.91 256.58C1170.93 256.624 1170.94
                   256.67 1170.96 256.718C1170.97 256.763 1170.98 256.809 1170.99 256.856C1171 256.903 1171 256.951 1171 257V343L1171
                   343.103C1170.99 343.2 1170.96 343.294 1170.92 343.381C1170.92 343.394 1170.91 343.406 1170.91 343.418C1170.89
                   343.463 1170.86 343.507 1170.83 343.548C1170.83 343.558 1170.82 343.568 1170.81 343.578C1170.8 343.595 1170.79
                   343.612 1170.78 343.629C1170.77 343.634 1170.77 343.639 1170.76 343.645C1170.75 343.662 1170.73 343.68 1170.72
                   343.696C1170.71 343.703 1170.7 343.709 1170.7 343.716C1170.68 343.733 1170.66 343.75 1170.64 343.766C1170.64
                   343.769 1170.63 343.772 1170.63 343.775C1170.61 343.79 1170.59 343.803 1170.58 343.816C1170.57 343.823 1170.56
                   343.83 1170.54 343.837C1170.53 343.849 1170.51 343.861 1170.49 343.872C1170.48 343.875 1170.48 343.878 1170.47
                   343.881C1170.45 343.89 1170.44 343.898 1170.42 343.906C1170.4 343.914 1170.39 343.922 1170.37 343.929C1170.36
                   343.931 1170.36 343.933 1170.35 343.935C1170.33 343.944 1170.31 343.952 1170.28 343.959C1170.24 343.972 1170.19
                   343.982 1170.14 343.988C1170.1 343.995 1170.05 344 1170 344H329.999L329.897 343.995C329.83 343.988 329.766 343.974
                   329.703 343.955C329.698 343.954 329.693 343.952 329.688 343.95C329.665 343.942 329.641 343.933 329.618 343.924C329.608
                   343.92 329.598 343.915 329.588 343.91C329.54 343.889 329.495 343.864 329.451 343.835C329.441 343.828 329.431 343.822
                   329.421 343.814C329.166 343.633 328.999 343.336 328.999 343C328.999 342.993 329 342.987 329 342.98V228C329 227.448
                   329.448 227 330 227H352V222.227L362 228Z"
            />
            <use href="#ma-addr" fill="white"/>
            <path
                id="ma-alu"
                d="M671 220.773L661 226.547V221.773H636V341.773H1169V257.773H1125C1124.45 257.773 1124 257.326 1124 256.773C1124
                256.221 1124.45 255.773 1125 255.773H1170C1170.05 255.773 1170.1 255.778 1170.14 255.784C1170.19 255.791 1170.24
                255.8 1170.28 255.813C1170.31 255.821 1170.33 255.829 1170.35 255.838C1170.36 255.84 1170.36 255.842 1170.37 255.844C1170.39
                255.85 1170.4 255.859 1170.42 255.866C1170.44 255.874 1170.45 255.882 1170.47 255.892C1170.48 255.894 1170.48 255.898
                1170.49 255.9C1170.51 255.912 1170.53 255.923 1170.54 255.936C1170.56 255.942 1170.57 255.949 1170.58 255.956C1170.59
                255.969 1170.61 255.983 1170.63 255.997C1170.63 256 1170.64 256.004 1170.64 256.007C1170.66 256.023 1170.68 256.039 1170.7
                256.057C1170.7 256.063 1170.71 256.07 1170.72 256.076C1170.73 256.093 1170.75 256.11 1170.76 256.128C1170.77 256.133 1170.77
                256.138 1170.78 256.144C1170.79 256.16 1170.8 256.177 1170.81 256.194C1170.82 256.204 1170.83 256.214 1170.83 256.225C1170.86
                256.264 1170.88 256.306 1170.9 256.349C1170.91 256.364 1170.92 256.38 1170.93 256.396C1170.96 256.482 1170.99 256.574 1171
                256.671L1171 256.773V342.779C1171 343.332 1170.55 343.779 1170 343.779C1169.96 343.779 1169.93 343.777 1169.89 343.773H635L634.897
                343.769C634.427 343.721 634.053 343.346 634.005 342.876L634 342.773V220.773C634 220.221 634.448 219.773 635 219.773H661V215L671 220.773Z"
            />
            <use href="#ma-alu" fill="white"/>
            <path
                id="mux-mem"
                d="M399 76C398.448 76 398 76.4477 398 77C398 77.5523 398.448 78 399
                   78V76ZM492 77L482 71.2265V82.7735L492 77ZM399 77V78H483V77V76H399V77Z"
            />
            <use href="#mux-mem" fill="white"/>
            <path
                id="mux-alu"
                d="M708 241C707.448 241 707 241.448 707 242C707 242.552 707.448 243 708
                   243V241ZM757 242L747 236.226V247.774L757 242ZM708 242V243H748V242V241H708V242Z"
            />
            <use href="#mux-alu" fill="white"/>
            <path
                id="ir-control"
                d="M302 257C302.552 257 303 257.448 303 258V353H307.773L302 363L296.227 353H301V259H261C260.448
                   259 260 258.552 260 258C260 257.448 260.448 257 261 257H302Z"
            />
            <use href="#ir-control" fill="white"/>
            <path
                id="acc-control"
                d="M1155 120C1155.55 120 1156 120.448 1156 121V353.002H1160.77L1155 363.002L1149.23
                   353.002H1154V122.001H1125C1124.45 122.001 1124 121.553 1124 121.001C1124 120.449 1124.45
                   120.001 1125 120.001H1154.98C1154.99 120.001 1154.99 120 1155 120Z"
            />
            <use href="#acc-control" fill="white"/>

            <Bus x={590} y={147} number={16}/>
            <Bus x={720} y={147} number={16}/>
            <Bus x={872} y={130} number={16}/>
            <Bus x={1130} y={112} number={16}/>

            <use href="#mux-pc" className={ branching || nop ? "fill-red-500" : "" } />
            <use href="#pc-mux" className={ fetch ? "fill-red-500" : "" } />
            <use href="#inc" className={ nop ? "fill-red-500" : "" } />
            <use href="#mux3-mem" className={ fetch || addr|| addSubX || loadI || storeI ? "fill-red-500" : "" } />
            <use href="#mem-alu" className={ addSubMul || addSubA || addSubX ? "fill-red-500" : "" } />
            <use href="#mem-ir" className={ fetch ? "fill-red-500" : "" } />
            <use href="#mem-acc" className={ load || loadI ? "fill-red-500" : "" } />
            <use href="#mem-ma" className={ loadA ? "fill-red-500" : "" } />
            <use href="#alu-acc" className={ addSubMul || addSubX || sh ? "fill-red-500" : "" } />
            <use href="#alu-ma" className={ addSubA ? "fill-red-500" : "" } />
            <use href="#ir-mem" className={ addr ? "fill-red-500" : "" } />
            <use href="#ir-pc" className={ branching ? "fill-red-500" : "" } />
            <use href="#mux-acc" className={ addSubMul || addSubX || sh || load || loadI ? "fill-red-500" : "" } />
            <use href="#mux-ma" className={ addSubA || loadA ? "fill-red-500" : "" } />
            <use href="#acc-alu" className={ addSubMul || addSubX || sh ? "fill-red-500" : "" } />
            <use href="#acc-mem" className={ store || storeI ? "fill-red-500" : "" } />
            <use href="#ma-mem" className={ storeA ? "fill-red-500" : "" } />
            <use href="#ma-addr" className={ addSubX || loadI || storeI ? "fill-red-500" : "" } />
            <use href="#ma-alu" className={ addSubA ? "fill-red-500" : "" } />
            <use href="#mux-mem" className={ store || storeA || storeI ? "fill-red-500" : "" } />
            <use href="#mux-alu" className={ addSubMul || addSubA || addSubX || sh ? "fill-red-500" : "" } />
            <use href="#ir-control" className={ decode ? "fill-red-500" : "" } />
            <use href="#acc-control" className={ decode ? "fill-red-500" : "" } />

            <Multiplexer x={41} y={70} name="sel_pc_source" isActivated={ branching || nop } />
            <Multiplexer x={360} y={40} name="sel_mem_data" isActivated={ store || storeA || storeI } />
            <Multiplexer x={360} y={165} name="sel_mem_addr" isActivated={ fetch || addr || loadI || storeI || addSubX } />
            <Multiplexer x={669} y={200} name="alu_b_source" isActivated={ addSubMul || addSubA || sh || addSubX } />
            <Multiplexer x={900} y={80} name="sel_acc_data" isActivated={ addSubMul || sh || load || loadI || addSubX } />
            <Multiplexer x={900} y={215} name="sel_ma_source" isActivated={ addSubA || loadA } />

            <ALU x={755} y={123} isActivated={ addSubMul || addSubA || sh || addSubX } />

            <ObscureMemory name="Mémoire" controlName="wr_mem" className="fill-green-500" x={491} y={40} hasControlSignal={true} isWritable={ store || storeA || storeI } >
                <text x="5" y="70" dominantBaseline="middle" fill="black">data_in</text>
                <text x="5" y="298" dominantBaseline="middle" fill="black">addr</text>
                <text x="165" y="212" textAnchor="end" dominantBaseline="middle" fill="black">data_out</text>
            </ObscureMemory>            

            <RegisterBox name="PC" number={steps[count].pcState} x={140} y={77} className="bg-pc" isActivated={ branching || nop } />
            <RegisterBox name="IR" number={steps[count].irState} x={140} y={225} className="bg-ir" isActivated={ fetch } />
            <RegisterBox 
                name="ACC"
                number={steps[count].accState ? steps[count].accState : 0}
                x={1005}
                y={87}
                className="bg-acc" defaultIsBase10={true} isActivated={ addSubMul || load || loadI || addSubX || sh }
            />
            <RegisterBox
                name="MA"
                number={steps[count].ma ? steps[count].ma : 0}
                x={1005}
                y={225}
                className="bg-ma"
                isActivated={ addSubA || loadA }
            />

            <circle cx="616" cy="156" r="5" className={ fetch || addSubMul || addSubA || addSubX || load || loadA || loadI ? "fill-red-500" : "fill-white" } />
            <circle cx="841" cy="97" r="5" className={ load || loadA || loadI ? "fill-red-500" : "fill-white" } />
            <circle cx="865" cy="195" r="5" className={ addSubMul || addSubA || addSubX || sh ? "fill-red-500" : "fill-white" } />
            <circle cx="1155" cy="121" r="5" className={ decode || addSubMul || addSubX || sh || store || storeI ? "fill-red-500" : "fill-white" } />
            <circle cx="302" cy="203" r="5" className={ branching || addr ? "fill-red-500" : "fill-white" } />
            <circle cx="1170" cy="257" r="5" className={ addSubA || addSubX || loadI || storeA || storeI ? "fill-red-500" : "fill-white" } />
            <circle cx="635" cy="343" r="5" className={ addSubA || addSubX || loadI || storeI ? "fill-red-500" : "fill-white" } />
            <circle cx="302" cy="258" r="5" className={ decode || branching || addr ? "fill-red-500" : "fill-white" } />
            <circle cx="291" cy="110" r="5" className={ fetch || nop ? "fill-red-500" : "fill-white" } />
            <circle cx="1155" cy="329" r="5" className={ decode || addSubMul || addSubX || sh ? "fill-red-500" : "fill-white" } />

            <g>
                <rect x="291.5" y="363.5" width="873" height="37" fill="white" stroke="black" />
                <text textAnchor="middle" dominantBaseline="middle" x={728} y={382} className="text-xl font-semibold fill-black">Control Signal</text>
            </g>

            <g>
                <rect x="141.5" y="20.5" width="39" height="39" fill="white" stroke="black" />
                <text textAnchor="middle" dominantBaseline="middle" x={161} y={40} className="text-xl fill-black" >+1</text>
            </g>
        </svg>

    );
}
